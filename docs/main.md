# Elyos Installer Documentation

## Общая информация
Проект: **Elyos Installer**  
Назначение: установщик дистрибутива Arch/Elyos.  
Главный исполняемый файл создаётся из `main.cpp`, который создаёт объект класса `App` и вызывает метод `run()`.

---

## Структура проекта

### /src/core/
Содержит основные компоненты установщика:

- **context.cpp**  
  - Хранит состояние установщика (`InstallerContext`)  
  - Хранит выбранный диск, разметку, пакеты, графику и т.д.  
  - Заполняется во время выполнения программы.

- **logger.cpp**  
  - Логгер (`Logger`)  
  - Записывает события установки в файл несколько раз за шаг  
  - Пример лога:
    ```
    [2025-11-23 22:45:21][INFO] Installer started
    [2025-11-23 22:45:22][INFO] Auto install started
    [2025-11-23 22:45:23][INFO] Selected disk: /dev/sda
    [2025-11-23 22:45:23][INFO] Installer stopped
    ```

- **step_manager.cpp**  
  - Управляет списком шагов установки (`StepManager`)  
  - Вызывает все шаги, добавленные в список для текущего режима.

- **ui.cpp**  
  - Работа с `ncurses`  
  - Создаёт и управляет окнами, отображением текста и меню.

- **utils.cpp**  
  - Набор вспомогательных функций для шагов установки  
  - Выполняет системные команды (`exec`)  
  - Предназначен для работы с файлами, путями и другими утилитами (часть функций пока не реализована)

---

### /src/dialogs.*
- Мини-библиотека для диалогов с пользователем (аналог `dialog`)  
- Вывод информационных окон и сообщений  
- Создание меню для выбора вариантов  
- Получение ввода пользователя (текст, числа, подтверждения)  
- Используется в шагах (`steps`) и режимах (`modes`) через ncurses

---

### /src/modes/
Режимы работы установщика:

- **auto_install**  
  - Автоматический режим установки (`AutoInstall`)  
  - Создаёт объект `StepManager`  
  - Добавляет шаги (`ShowPartitionInfo`, `ShowDisks`)  
  - Запускает цикл выполнения шагов через `manager.run(win)`

- **manual_install, iso_builder, recovery**  
  - Пока что пустышки (не реализованы)

---

### /src/steps/
Шаги установки, сгруппированные по категориям:

- Каждый шаг реализует метод `run(WINDOW* win)` и возвращает `StepResult`  
- Примеры:
  - **disk_steps** — `ShowPartitionInfo` показывает информацию о разметке диска и предупреждает о стирании данных
  - **audio_steps, graphics_steps, packages_steps, final_steps, test_steps** — содержат шаги, относящиеся к своей категории

---

### /include/
Заголовочные файлы, содержащие объявления классов и функций:

- `app.hpp` — класс `App`  
- `context.hpp` — `InstallerContext`  
- `dialogs.hpp` — функции для работы с диалогами  
- `json.hpp` — сторонняя библиотека для работы с JSON (nlohmann/json)  
- `logger.hpp` — класс `Logger`  
- `step.hpp` — отдельные шаги установки (`Step`)  
- `step_manager.hpp` — `StepManager`  
- `ui.hpp` — функции для работы с ncurses окнами  
- `utils.hpp` — вспомогательные функции (`exec`, работа с файлами и др.)

---

### /licenses и LICENSE
- `/licenses` — лицензии сторонних библиотек (например, `NLOHMANN.MIT`)  
- `LICENSE` — лицензия проекта (MIT)

---

### /build/
Папка для сборки проекта:

- `app` — скомпилированный исполняемый файл  
- `src/` — объектные файлы (`*.o`) и скомпилированные файлы по структуре исходников  
- Назначение: хранение промежуточных и конечных результатов компиляции

---

### Makefile
- Сценарий сборки проекта  
- Компилирует исходники и создаёт исполняемый файл `app`  
- Поддерживает опции:  
  - `make run` — собрать и запустить установщик  
  - `make debug` — собрать с отладочной информацией

---

### README.md
- Краткое описание проекта и инструкций для сборки и запуска

---

### json.hpp
- Сторонняя библиотека [nlohmann/json]  
- Работа с JSON: чтение, запись, обработка данных

---

## Примечания
- Основной цикл работы приложения реализован в классе `App`  
- Взаимодействие с пользователем идёт через ncurses и библиотеку `dialogs`  
- Шаги установки (`steps`) и режимы (`modes`) управляются через `StepManager`  
- Логирование ведётся через `Logger`  

